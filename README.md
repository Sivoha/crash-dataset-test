Для начала работы залейте ваш датасет в папку `../input/frames_50_video/` - должно быть N видео в MP4 и N CSV файлов.

### Препроцессинг

* `preproc_data/r02_create_kfold_split.py` - Разбивает все видео на тренировочные и валидационные (5 фолдов).
* `preproc_data/r03_preproc_data_v1.py` - Разбивает видео на отдельные фреймы в формате PNG. И генерирует файл train.csv 
с путями до фреймов и значением target от 0 до 2.   

### Сеть номер 1

У сети один выход, она классифицирует отдельные кадры, пытаясь предсказать есть авария в данном кадре или нет.
То есть когда в кадре "before crush" или "after crush" - значение нейрона 0, когда "crush moment" - значение 1. 
Используется сеть EfficientNet v2 предобученная на ImageNet 21K. Я пробовал разные разрешения 384х384, 180х320 и 360х640.
На данный момент лучше всего результат даёт 384x384.   

* Находится в директории `net_v01_effnet_1_classes`
* `a01_settings.py` - настройки запуска (Замечание: настройки сделаны для NVIDIA A6000 48 GB памяти. Для меньшего размера памяти надо сократить размер batch)
* `a03_models_2D.py` - описание модели
* `r30_train_model.py` - запуск тренировки
* `r50_process_validation_and_test.py` - валидация
* `r60_inference.py` - запуск предсказания для новых видео. На вход видео, на выходе CSV с результатами и новое видео с предсказанной разметкой.

Качество предсказаний было среднее на 50 видео: AUC: 0.700 Accuracy: 0.794 Log loss: 0.473

Качество стало лучше на 118 видео: AUC: 0.783 Accuracy: 0.863 Log loss: 0.461

Использовался один и тот же валидационный набор.

**Замечание 1**: метрика ROC AUC хорошо подходит для несбалансированных датаестов. Чем ближе к 1 - тем лучше.

#### Инференс

Для инференса используется скрипт `r60_inference.py`. Постарался максимально его изолировать от остального кода - у него нет зависимостей от тренировки.

Пример запуска для видео:
```bash
python net_v01_effnet_1_classes/r60_inference.py
    --input_video ../../input/frames_50_video/w2_1.mp4
    --input_csv ../../input/frames_50_video/w2_1.csv
    --output_csv ../../cache/w2_1_proc.mp4.csv
    --model ../../models/net_v01_effnet_v2_l_384/best/effnet_v2_l_pytorch_fold_0-384px-auc_0.700435-acc-0.794321-ll-0.473547-ep-11.pt
    --output_video
    --width 384
    --height 384
```

**Замечания**:
* `--input_csv` - необязательный параметр, если задан, то выведутся посчитанные метрики качества для видео
* ` --output_video` - выведет видео с предсказаниями в виде надписей на картинке
* Установите все модули из `requirements.txt`

Модель можно скачать здесь:
* [EffNet_v2_trained_crash_v1.pt](https://disk.yandex.ru/d/e5TOpi2_DU2PYQ) - версия 1 обученная на 50 видео
* [EffNet_v2_trained_crash_v2.pt](https://disk.yandex.ru/d/nSk11vPXT3QNIg) - версия 2 обученная на 118 видео